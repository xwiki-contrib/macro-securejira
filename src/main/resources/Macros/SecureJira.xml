<?xml version="1.0" encoding="UTF-8"?>
<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<xwikidoc>
  <web>Macros</web>
  <name>SecureJira</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <parent>Main.WebHome</parent>
  <creator>xwiki:XWiki.Admin</creator>
  <author>xwiki:XWiki.Admin</author>
  <customClass/>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <creationDate>1388527200000</creationDate>
  <date>1388527200000</date>
  <contentUpdateDate>1388527200000</contentUpdateDate>
  <version>1.1</version>
  <title>SecureJira</title>
  <defaultTemplate/>
  <validationScript/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>false</hidden>
  <class>
    <name>Macros.SecureJira</name>
    <customClass/>
    <customMapping/>
    <defaultViewSheet/>
    <defaultEditSheet/>
    <defaultWeb/>
    <nameField/>
    <validationScript/>
    <password>
      <algorithm/>
      <customDisplay/>
      <disabled>0</disabled>
      <name>password</name>
      <number>3</number>
      <picker>0</picker>
      <prettyName>password</prettyName>
      <size>30</size>
      <storageType>Clear</storageType>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.PasswordClass</classType>
    </password>
    <url>
      <customDisplay/>
      <disabled>0</disabled>
      <name>url</name>
      <number>1</number>
      <picker>0</picker>
      <prettyName>url</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
    </url>
    <username>
      <customDisplay/>
      <disabled>0</disabled>
      <name>username</name>
      <number>2</number>
      <picker>0</picker>
      <prettyName>username</prettyName>
      <size>30</size>
      <unmodifiable>0</unmodifiable>
      <validationMessage/>
      <validationRegExp/>
      <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
    </username>
  </class>
  <object>
    <class>
      <name>XWiki.WikiMacroClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>9</number>
        <prettyName>Macro code</prettyName>
        <rows>20</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <contentDescription>
        <disabled>0</disabled>
        <name>contentDescription</name>
        <number>8</number>
        <prettyName>Content description (Not applicable for "No content" type)</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </contentDescription>
      <contentType>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>contentType</name>
        <number>7</number>
        <prettyName>Macro content type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Optional|Mandatory|No content</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentType>
      <defaultCategory>
        <disabled>0</disabled>
        <name>defaultCategory</name>
        <number>4</number>
        <prettyName>Default category</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultCategory>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>3</number>
        <prettyName>Macro description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <id>
        <disabled>0</disabled>
        <name>id</name>
        <number>1</number>
        <prettyName>Macro id</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </id>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>2</number>
        <prettyName>Macro name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <supportsInlineMode>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>supportsInlineMode</name>
        <number>5</number>
        <prettyName>Supports inline mode</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </supportsInlineMode>
      <visibility>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>visibility</name>
        <number>6</number>
        <prettyName>Macro visibility</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Current User|Current Wiki|Global</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </visibility>
    </class>
    <name>Macros.SecureJira</name>
    <number>0</number>
    <className>XWiki.WikiMacroClass</className>
    <guid>0fba837d-f016-4703-af58-1ae7cdf48e89</guid>
    <property>
      <code>{{groovy}}

import org.apache.velocity.tools.generic.EscapeTool;
import java.text.SimpleDateFormat;
import java.text.ParsePosition;
import org.xwiki.rendering.macro.MacroExecutionException

// Get the macro parameters and macro content
def jiraURLMacroParameter = xcontext.macro.params.url;
def styleMacroParameter = (xcontext.macro.params.style==null||xcontext.macro.params.style=="") ? "table" : xcontext.macro.params.style.trim();
def columnsMacroParameter = xcontext.macro.params.columns;
def columnsNamesMacroParameter = xcontext.macro.params.columnsNames;
def enableNotesMacroParameter = xcontext.macro.params.notes.trim();
def enableJqlMacroParameter = xcontext.macro.params.jql.trim();
def macroContent = xcontext.macro.content.trim();

def escapetool = new EscapeTool();

// read username/password/url
def passdoc = xwiki.getDocument("Macros.SecureJiraConfig");
def jiraURLDefault = passdoc.getValue("url")
def jiraUsername = null;
def jiraPassword = null;

if (jiraURLMacroParameter==null || jiraURLMacroParameter=="")
 jiraURLMacroParameter = jiraURLDefault.trim();
else {
 jiraURLMacroParameter = jiraURLMacroParameter.trim();
}

def passobj = passdoc.getObject("Macros.SecureJiraConfigClass", "url", jiraURLMacroParameter, false)
if(passobj)
  passdoc.use(passobj)
jiraPassword = (passobj==null) ? null : passobj.getProperty("password").getBaseProperty().getValue()
jiraUsername = passdoc.getValue("username")

if (xcontext.macro.context.isInline()){
    if (styleMacroParameter.equals("table") || styleMacroParameter.equals("list")){
        throw new MacroExecutionException("Using this style is not allowed in inline mode");
    }
}
def displayIssueData(issue, columns, displayType, enableNotesMacroParameter, note) {
    def sep = "";
    if(displayType == "table") {
        sep = "|";
    }
    else if (displayType == "list") {
        sep = " ";
    }
    else if (displayType == "enum") {
        sep = " ";
    }
    
    columns.each {   
             if (it.equals("key"))  { print "${sep}[[${issue.key}&gt;&gt;${issue.link}]]" }
             else if (it.equals("type")) { print "${sep}[[image:${issue.type.@iconUrl}]]"}
             else if (it.equals("status")) { print "${sep}[[image:${issue.status.@iconUrl}]]" }
             else if (it.equals("priority")) { print "${sep}[[image:${issue.priority.@iconUrl}]]" }
             else if (it.equals("created")) { 
                def sdf = new SimpleDateFormat("EEE, d MMM yyyy HH:mm:ss Z")
                def createdDate = sdf.parse(issue.created.toString(), new ParsePosition(0))
                sdf = new SimpleDateFormat("dd-MMM-yyyy")
                print "${sep}${sdf.format(createdDate)}" 
            }
            else{    
            print   "${sep}{{{" + issue."${it}" + "}}}"
            }
        }
        
        if (enableNotesMacroParameter) { print "${sep}${note}"  }
        if (displayType != "enum" ) { println "" }
}

def generateJQLIDs(macroContent, enableNotesMacroParameter, issueNoteList){

    def issueIdList = []
    // Read and parse macro content
    macroContent.eachLine { line -&gt;
        def lineParams = line.split("[|]")
        // If notes are true, we take the second parameter too
        if (enableNotesMacroParameter=="true") {
            issueIdList.add(lineParams[0].trim())
            if (lineParams.size() &gt; 1) {
                issueNoteList.add(lineParams[1].trim())
            }    
            else {
                issueNoteList.add("")
            }
        }
        else {
            issueIdList.add(lineParams[0])
        }
    }
    //Now that we have the id's and required columns, we can create the JQL
    issueIdList = issueIdList.collect{ "issueKey=" +it}
    return issueIdList.join("+OR+") + "&amp;"
}


def generateColumnsArray(columnsMacroParameter, columnsNamesMacroParameter, styleMacroParameter, columns, columnsNames){
    def columnsParameters = []
    def columnsNamesParameters = []
    // We build the Columns ArrayList
    if (columnsMacroParameter){
        columnsParameters = columnsMacroParameter.split("[,]").collect{it.trim();}
        }
    switch (styleMacroParameter) {
        case "table": if (columnsParameters.size()== 0) columnsParameters = ["type", "key", "status", "summary", "assignee"]; break;
        case "list":  if (columnsParameters.size()== 0) columnsParameters = ["status", "key", "summary"]; break;
        case "enum":  if (columnsParameters.size()== 0) columnsParameters = ["status", "key"]; break;
    }
    
    // We build the Columns Names ArrayList
    if (columnsNamesMacroParameter){
        columnsNamesParameters = columnsNamesMacroParameter.split("[,]").collect{it.trim();}
        }
    else{
        if (styleMacroParameter.equals("table")) { 
            if (columnsNamesParameters.size()== 0) columnsNamesParameters = ["Type", "Key", "Status", "Summary", "Assignee"];
            }
        }
           
    // We create the JQL portion regarding the columns/fields we want and we also append the link field which is used internally

    columns.addAll(columnsParameters)
    columnsNames.addAll(columnsNamesParameters)
    columnsParameters = columnsParameters.collect{"field=" + it.trim()}
    return columnsParameters.join("&amp;") + "&amp;field=link"
}

def getErrorType(message){
    if (message.contains("401")) {
      return msg.get('securejira.badlogorcaptcha')
    } else if (message.contains("400")) {
     return msg.get('securejira.jiranotfoundornoaccess')
    } else {
     return msg.get('securejira.unknowerror')
    }
}

// Build the URL
def URL = jiraURLMacroParameter + "/sr/jira.issueviews:searchrequest-xml/temp/SearchRequest.xml?jqlQuery="


def columns =[]
def columnsNames = []
def issueNoteList = []
if (enableJqlMacroParameter.equals("true")){
       URL += URLEncoder.encode(macroContent, "UTF-8")      
       URL += "&amp;" + generateColumnsArray(columnsMacroParameter, columnsNamesMacroParameter, styleMacroParameter, columns, columnsNames)
        }
else {
        URL += generateJQLIDs(macroContent, enableNotesMacroParameter, issueNoteList)
        URL += generateColumnsArray(columnsMacroParameter, columnsNamesMacroParameter, styleMacroParameter, columns, columnsNames)           
}

// we add authentication here
if (jiraUsername!=null &amp;&amp; jiraUsername.trim()!="") {
  URL = "${URL}&amp;os_username=${jiraUsername}&amp;os_password=${jiraPassword}&amp;os_authType=basic"
}

try {
def root = new XmlSlurper().parseText(URL.toURL().text)

if (styleMacroParameter.equals("table")) {
    columnsNames.each{ print "|=" + it.capitalize() }
    if (enableNotesMacroParameter.equals("true")) { print "|=Notes" }
    println""

    root.channel.item.eachWithIndex { issue, i -&gt;
        displayIssueData(issue, columns, "table", enableNotesMacroParameter.equals("true"), issueNoteList[i]);
    }
}

else if (styleMacroParameter.equals("list"))
{
    root.channel.item.eachWithIndex { issue, i -&gt;
        displayIssueData(issue, columns, "list", enableNotesMacroParameter.equals("true"),issueNoteList[i]);
    }
}

else if (styleMacroParameter.equals("enum"))
{
    root.channel.item.eachWithIndex { issue, i -&gt;
        displayIssueData(issue, columns, "enum", false ,null);
    }
}
} catch (Exception e) {
  def mess = e.message;
  println getErrorType(mess)
  def i1 = mess.indexOf("os_password");
  def mess2 = (i1==-1) ? mess : mess.substring(0, i1);
  println "(jira macro failed: ${mess2} see in log file)"
  e.printStackTrace();
}

{{/groovy}}</code>
    </property>
    <property>
      <contentDescription>Put each issue on a new line or specify a JQL query.</contentDescription>
    </property>
    <property>
      <contentType>Mandatory</contentType>
    </property>
    <property>
      <defaultCategory/>
    </property>
    <property>
      <description/>
    </property>
    <property>
      <id>securejira</id>
    </property>
    <property>
      <name>securejira</name>
    </property>
    <property>
      <supportsInlineMode>1</supportsInlineMode>
    </property>
    <property>
      <visibility>Current Wiki</visibility>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <name>Macros.SecureJira</name>
    <number>0</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>e8405ad0-e9c4-43f8-a4d6-cef58709f96a</guid>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>The URL to your JIRA</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>url</name>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <name>Macros.SecureJira</name>
    <number>1</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>5df715ff-b12c-45dc-b507-de8720f0a0bd</guid>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>Parameter which describes the way the macro should display the results:
available options: table, list, enumeration</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>style</name>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <name>Macros.SecureJira</name>
    <number>2</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>7726d351-98aa-4027-835f-6d4b477f8c60</guid>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>Parameter which describes the columns that will be displayed when using the table option. These values represent fields from JIRA like type, id, assignee, status</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>columns</name>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <name>Macros.SecureJira</name>
    <number>3</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>fee88ce7-3731-4570-90b4-14b3bd3fe63a</guid>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>The name of the columns you want to be used in the table header. They must have the same order as in columns parameter</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>columnsNames</name>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <name>Macros.SecureJira</name>
    <number>4</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>5ec88259-c7f3-45c0-93b6-ebec85a99ac7</guid>
    <property>
      <defaultValue>false</defaultValue>
    </property>
    <property>
      <description>Parameter which takes additional notes and puts them in a separate column. This information must be specified near the issue. This information is not taken from JIRA</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>notes</name>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <name>Macros.SecureJira</name>
    <number>5</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>8865929f-fdf6-4b74-a2ce-8d553ce1e51d</guid>
    <property>
      <defaultValue>false</defaultValue>
    </property>
    <property>
      <description>If true, it will interpret the macro content as a JQL Query</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>jql</name>
    </property>
  </object>
  <content>
{{velocity}}
#if($request.confirm)
= JIRA Macro as Table with no columns defined, using the default hardcoded ones =

{{securejira style="table" url="http://jira.xwiki.org" notes="true"}}
XWIKI-1000
{{/securejira}}

{{securejira style="table" notes="true" url="http://jira.xwiki.org" }}
XWIKI-1000| HARD TO FIX
XWIKI-4356|EASY TO FIX
XWIKI-3677|This issue takes too long. Please find a solution ASAP
{{/securejira}}

= JIRA Macro as Table using custom columns =

{{securejira style="table" columns="type,key, summary,status, assignee, created" columnsNames="Issue type,Issue Id, Short description,Issue Status, Person to Fix this, Creation Date" notes="true" url="http://jira.xwiki.org" }}
XWIKI-1000|HARD TO FIX
XWIKI-4356|EASY TO FIX
XWIKI-3677|This issue takes too long. Please find a solution ASAP
{{/securejira}}

= JIRA Macro as List with no columns defined, using the default hardcoded ones =

{{securejira style="list" notes="true" url="http://jira.xwiki.org"}}
XWIKI-1000|Note 1
XWIKI-4356|Note 2
XWIKI-3677|Note 3
{{/securejira}}

= JIRA Macro as List using custom columns =

{{securejira style="list" columns="key, summary,type,status, assignee, created" columnsNames="Issue Id, Description, Issue type, Issue status, Who will fix it ?, Creation Date" notes="true" url="http://jira.xwiki.org"}}
XWIKI-1000|Note 1
XWIKI-4356|Note 2
XWIKI-3677|Note 3
{{/securejira}}

= JIRA Macro as Enum with no columns defined, using the default hardcoded ones =

{{securejira style="enum" notes="false" url="http://jira.xwiki.org"}}
XWIKI-1000|Note 1
XWIKI-4356|Note 2
XWIKI-3677|Note 3
{{/securejira}}

= JIRA Macro as Enum, using custom columns =

{{securejira style="enum" columns="key, status, type" columnsNames="Issue Id, Issue Status, What Type is this?" url="http://jira.xwiki.org"}}
XWIKI-1000|Note 1
XWIKI-4356|Note 2
XWIKI-3677|Note 3
{{/securejira}}

= JIRA Macro as Table using JQL with no columns defined, using the default hardcoded ones =

{{securejira style="table" jql="true" url="http://jira.xwiki.org"}}
(project in (XWIKI) and fixVersion in ("3.2 M1", "3.2 M2", "3.2 M3", "3.2 RC1", "3.2") and resolution in ("Fixed")) or (project in (XE) and fixVersion in ("3.2 M1", "3.2 M2", "3.2 M3", "3.2 RC1", "3.2") and resolution in ("Fixed")) or (project in (XRENDERING) and fixVersion in ("3.2 M1", "3.2 M2", "3.2 M3", "3.2 RC1", "3.2") and resolution in ("Fixed")) or (project in (XCOMMONS) and fixVersion in ("3.2 M1", "3.2 M2", "3.2 M3", "3.2 RC1", "3.2") and resolution in ("Fixed")) or (project in (XEM) and fixVersion in ("3.2 M1", "3.2 M2", "3.2 M3", "3.2 RC1", "3.2"))
{{/securejira}}

= JIRA Macro as Table using JQL with custom columns defined =

{{securejira style="table" columns="key, status, type, summary, key, key" columnsNames="Issue Id, What is the status ? , Issue type, The summary, key ONE, Same key again" jql="true" url="http://jira.xwiki.org"}}
(project in (XWIKI) and fixVersion in ("3.2 M1", "3.2 M2", "3.2 M3", "3.2 RC1", "3.2") and resolution in ("Fixed")) or (project in (XE) and fixVersion in ("3.2 M1", "3.2 M2", "3.2 M3", "3.2 RC1", "3.2") and resolution in ("Fixed")) or (project in (XRENDERING) and fixVersion in ("3.2 M1", "3.2 M2", "3.2 M3", "3.2 RC1", "3.2") and resolution in ("Fixed")) or (project in (XCOMMONS) and fixVersion in ("3.2 M1", "3.2 M2", "3.2 M3", "3.2 RC1", "3.2") and resolution in ("Fixed")) or (project in (XEM) and fixVersion in ("3.2 M1", "3.2 M2", "3.2 M3", "3.2 RC1", "3.2"))
{{/securejira}}

= Access to a secured Jira task =

{{securejira style="table" url="http://jira.xwiki.org" notes="true"}}
XWIKI-5024
{{/securejira}}


{{securejira style="table" url="http://jira.xwiki.org" notes="true"}}
XWIKI-214328432
{{/securejira}}

{{securejira style="table" url="http://jira.xwiki.org" notes="true"}}
TOTO-214328432
{{/securejira}}

#else
[[See examples&gt;&gt;||queryString="confirm=1"]]
#end
{{/velocity}}
</content>
</xwikidoc>
